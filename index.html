<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Jishnu Calculator</title>

    <style>
        * { box-sizing: border-box; }

        :root {
            --bg: radial-gradient(circle at top, #1d1f2a 0, #05060b 50%, #000000 100%);
            --panel: rgba(21, 23, 33, 0.86);
            --accent: #0a84ff;
            --accent-soft: #2f9bff;
            --danger: #ff3b30;
            --op: #ff9f0a;
            --text-main: #ffffff;
            --text-sub: #a8b0c5;
            --shadow-soft: 0 24px 60px rgba(0, 0, 0, 0.85);
            --radius-xl: 26px;
            --radius-md: 18px;
            --transition-fast: 0.15s cubic-bezier(0.17, 0.67, 0.47, 1);
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .calculator-shell {
            width: 100%;
            max-width: 420px;
            height: min(100%, 800px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calculator {
            width: 100%;
            height: 100%;
            max-height: 780px;
            background: linear-gradient(145deg, rgba(36,39,53,0.92), rgba(8,10,18,0.98));
            border-radius: var(--radius-xl);
            padding: clamp(16px, 3vh, 22px);
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);

            display: flex;
            flex-direction: column;
            gap: clamp(10px, 2vh, 18px);
            animation: shellEnter 0.35s ease-out;
        }

        @keyframes shellEnter {
            from { opacity: 0; transform: translateY(18px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .header-title { display: flex; flex-direction: column; }

        .header-title .title {
            font-size: clamp(1.2rem, 2.8vw, 1.5rem);
            letter-spacing: 0.08em;
            font-weight: 600;
        }

        .header-title .subtitle {
            margin-top: 3px;
            font-size: clamp(0.7rem, 1.8vw, 0.86rem);
            color: var(--text-sub);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 999px;
            background: radial-gradient(circle at top left, #3a7cff, #2357c8);
            box-shadow:
                0 8px 16px rgba(26, 115, 232, 0.6),
                0 0 0 1px rgba(255,255,255,0.16);
            font-size: 0.78rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #ffffff;
        }

        .display {
            background: radial-gradient(circle at top left, #14151f, #020308);
            border-radius: 22px;
            padding: clamp(12px, 2vh, 18px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow:
                inset 0 1px 3px rgba(255,255,255,0.06),
                0 14px 28px rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            min-height: clamp(78px, 18vh, 120px);
        }

        .display-expression {
            text-align: right;
            color: rgba(205,215,240,0.7);
            font-size: clamp(0.8rem, 1.8vw, 1rem);
            margin-bottom: 4px;
            opacity: 0;
            transform: translateY(4px);
            transition: var(--transition-fast);
        }

        .display-expression.show {
            opacity: 1;
            transform: translateY(0);
        }

        .display-result {
            text-align: right;
            font-variant-numeric: tabular-nums;
            font-size: clamp(1.9rem, 6.4vw, 2.7rem);
            letter-spacing: 0.03em;
        }

        .display-result.bump {
            animation: resultBump 0.18s ease-out;
        }

        @keyframes resultBump {
            from { transform: translateX(-4px); opacity: 0.9; }
            to   { transform: translateX(0); opacity: 1; }
        }

        /* Mode tabs: Standard / AI Chat */
        .mode-tabs {
            display: flex;
            gap: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 999px;
            padding: 3px;
        }

        .mode-tab {
            flex: 1;
            border-radius: 999px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.7);
            padding: 6px 10px;
            font-size: 0.82rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .mode-tab.active {
            background: #0a84ff;
            color: #ffffff;
            box-shadow: 0 6px 16px rgba(0,0,0,0.7);
        }

        .panel {
            flex: 1;
            display: none;
            flex-direction: column;
            min-height: 0;
        }

        .panel.active {
            display: flex;
        }

        .pad-shell {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 1.6vh, 12px);
        }

        .row-top {
            display: flex;
            gap: 8px;
        }

        .chip {
            flex: 1;
            padding: 6px 12px;
            border-radius: 999px;
            background: linear-gradient(145deg, #262a35, #171922);
            border: 1px solid rgba(255,255,255,0.06);
            color: var(--text-sub);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* STANDARD KEYPAD */

        .buttons {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: clamp(8px, 1.6vh, 12px);
            align-content: stretch;
        }

        button {
            border: none;
            outline: none;
            cursor: pointer;

            border-radius: var(--radius-md);
            background: radial-gradient(circle at top left, #343644, #171925);
            color: var(--text-main);

            font-weight: 500;
            font-size: clamp(1rem, 3.2vw, 1.35rem);

            min-height: clamp(52px, 9vh, 80px);

            position: relative;
            overflow: hidden;

            box-shadow:
                0 10px 24px rgba(0, 0, 0, 0.9),
                -2px -2px 4px rgba(255,255,255,0.08),
                1px 1px 2px rgba(0,0,0,0.9);

            transition:
                transform var(--transition-fast),
                box-shadow var(--transition-fast),
                filter var(--transition-fast),
                background var(--transition-fast);
        }

        button::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: radial-gradient(circle at top, rgba(255,255,255,0.22), transparent 55%);
            opacity: 0;
            transition: opacity 0.15s ease-out;
        }

        button:hover::after { opacity: 1; }

        button:hover {
            transform: translateY(-1px);
            box-shadow:
                0 14px 30px rgba(0,0,0,0.95),
                -2px -2px 4px rgba(255,255,255,0.1),
                0 0 0 1px rgba(255,255,255,0.06);
        }

        button:active {
            transform: translateY(2px) scale(0.98);
            box-shadow:
                0 4px 10px rgba(0,0,0,0.9),
                inset 0 0 0 1px rgba(255,255,255,0.08);
            filter: brightness(0.96);
        }

        .btn-clear { background: linear-gradient(145deg, #ff5b5b, #b6181a); }
        .btn-back  { background: linear-gradient(145deg, #ffd95a, #ffb300); color: #171717; }
        .btn-op    { background: linear-gradient(145deg, #ffb547, #ff7a00); }

        .btn-equals {
            background: linear-gradient(160deg, var(--accent-soft), #0059d1);
            grid-column: 4 / 5;
            grid-row: 5 / 6;
            font-size: clamp(1.2rem, 3.4vw, 1.6rem);
        }

        .btn-zero {
            grid-column: 1 / 4;
            grid-row: 5 / 6;
        }

        /* AI CHAT PANEL */

        .chat-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 0;
        }

        .chat-window {
            flex: 1;
            background: radial-gradient(circle at top left, #191b26, #05060b);
            border-radius: 18px;
            padding: 10px 12px;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow:
                inset 0 1px 2px rgba(255,255,255,0.04),
                0 10px 24px rgba(0,0,0,0.85);
            overflow-y: auto;
        }

        .chat-msg {
            max-width: 85%;
            margin-bottom: 8px;
            padding: 8px 11px;
            border-radius: 14px;
            font-size: 0.9rem;
            line-height: 1.35;
            word-wrap: break-word;
            white-space: pre-line;
        }

        .chat-msg.user {
            margin-left: auto;
            background: linear-gradient(145deg, #2f9bff, #0060d6);
            box-shadow: 0 8px 16px rgba(0,0,0,0.6);
        }

        .chat-msg.bot {
            margin-right: auto;
            background: linear-gradient(145deg, #262a35, #171922);
            border: 1px solid rgba(255,255,255,0.08);
        }

        .chat-input-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(0,0,0,0.45);
            color: var(--text-main);
            padding: 8px 12px;
            font-size: 0.9rem;
            outline: none;
        }

        .chat-input::placeholder {
            color: rgba(255,255,255,0.35);
        }

        .chat-send {
            border-radius: 999px;
            padding: 8px 14px;
            border: none;
            background: linear-gradient(145deg, #3ba8ff, #0059d1);
            color: #ffffff;
            font-size: 0.9rem;
            white-space: nowrap;
            box-shadow: 0 8px 18px rgba(0,0,0,0.6);
            cursor: pointer;
        }

        @media (max-width: 360px) {
            .calculator {
                padding: 14px;
                border-radius: 22px;
            }
            button {
                min-height: 50px;
                font-size: 0.98rem;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-shell">
        <div class="calculator">
            <div class="header-row">
                <div class="header-title">
                    <div class="title">Jishnu Calculator</div>
                    <div class="subtitle">Standard · AI Math Chat</div>
                </div>
                <div class="badge">
                    <span class="badge-dot"></span>
                    <span id="mode-label">Standard</span>
                </div>
            </div>

            <div class="display" tabindex="0">
                <div class="display-expression" id="expression"></div>
                <div class="display-result" id="result">0</div>
            </div>

            <div class="mode-tabs">
                <button id="tab-standard" class="mode-tab active">Standard</button>
                <button id="tab-chat" class="mode-tab">AI Chat</button>
            </div>

            <!-- STANDARD MODE -->
            <div id="panel-standard" class="panel active">
                <div class="pad-shell">
                    <div class="row-top">
                        <div class="chip">Tap or use keyboard 0‑9, +‑*/ and Enter</div>
                    </div>

                    <div class="buttons">
                        <!-- Row 1 -->
                        <button class="btn-clear" onclick="playClick(420); clearDisplay()">C</button>
                        <button class="btn-back" onclick="playClick(520); backspace()">⌫</button>
                        <button class="btn-op" onclick="playClick(620); appendOp('/')">÷</button>
                        <button class="btn-op" onclick="playClick(620); appendOp('*')">×</button>

                        <!-- Row 2 -->
                        <button onclick="playClick(); appendDigit('7')">7</button>
                        <button onclick="playClick(); appendDigit('8')">8</button>
                        <button onclick="playClick(); appendDigit('9')">9</button>
                        <button class="btn-op" onclick="playClick(620); appendOp('-')">−</button>

                        <!-- Row 3 -->
                        <button onclick="playClick(); appendDigit('4')">4</button>
                        <button onclick="playClick(); appendDigit('5')">5</button>
                        <button onclick="playClick(); appendDigit('6')">6</button>
                        <button class="btn-op" onclick="playClick(620); appendOp('+')">+</button>

                        <!-- Row 4 -->
                        <button onclick="playClick(); appendDigit('1')">1</button>
                        <button onclick="playClick(); appendDigit('2')">2</button>
                        <button onclick="playClick(); appendDigit('3')">3</button>
                        <button onclick="playClick(); appendDot()">.</button>

                        <!-- Row 5 -->
                        <button class="btn-zero" onclick="playClick(); appendDigit('0')">0</button>
                        <button class="btn-equals" onclick="playClick(760); calculate()">=</button>
                    </div>
                </div>
            </div>

            <!-- AI CHAT MODE -->
            <div id="panel-chat" class="panel">
                <div class="chat-wrapper">
                    <div class="row-top">
                        <div class="chip">
                            Ask like: “what is 12 + 7?”, “30 divided by 6”, “5 into 9 minus 3”.
                        </div>
                    </div>

                    <div id="chat-window" class="chat-window"></div>

                    <div class="chat-input-row">
                        <input id="chat-input" class="chat-input"
                               type="text"
                               placeholder="Type a math question…"
                               autocomplete="off" />
                        <button class="chat-send" id="chat-send">Send</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ==== Standard calculator logic ====
        const expressionEl = document.getElementById("expression");
        const resultEl = document.getElementById("result");

        let currentExpression = "";
        let displayValue = "0";
        let hasResult = false;

        let audioCtx;

        function ensureAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playClick(freq = 800, duration = 0.08) {
            ensureAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            osc.type = "sine";
            gain.gain.value = 0.28;
            gain.gain.exponentialRampToValueAtTime(
                0.01,
                audioCtx.currentTime + duration
            );
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + duration);
        }

        function updateResultDisplay() {
            resultEl.textContent = displayValue;
            resultEl.classList.remove("bump");
            void resultEl.offsetWidth;
            resultEl.classList.add("bump");
        }

        function showExpression(expr) {
            if (!expr) {
                expressionEl.textContent = "";
                expressionEl.classList.remove("show");
                return;
            }
            expressionEl.textContent = expr;
            expressionEl.classList.add("show");
        }

        function clearDisplay() {
            currentExpression = "";
            displayValue = "0";
            hasResult = false;
            showExpression("");
            updateResultDisplay();
        }

        function backspace() {
            if (hasResult) {
                clearDisplay();
                return;
            }
            if (currentExpression.length > 0) {
                currentExpression = currentExpression.slice(0, -1);
                displayValue = currentExpression || "0";
                updateResultDisplay();
            }
        }

        function appendDigit(d) {
            if (hasResult) clearDisplay();
            currentExpression += d;
            displayValue = currentExpression;
            updateResultDisplay();
        }

        function appendDot() {
            if (hasResult) clearDisplay();
            const parts = currentExpression.split(/[^0-9.]/);
            const last = parts[parts.length - 1];
            if (last.includes(".")) return;
            if (currentExpression === "" || /[+\-*/]$/.test(currentExpression)) {
                currentExpression += "0.";
            } else {
                currentExpression += ".";
            }
            displayValue = currentExpression;
            updateResultDisplay();
        }

        function appendOp(op) {
            if (currentExpression === "" && op !== "-") return;
            if (/[+\-*/]$/.test(currentExpression)) {
                currentExpression = currentExpression.slice(0, -1) + op;
            } else {
                if (hasResult) {
                    hasResult = false;
                    showExpression("");
                }
                currentExpression += op;
            }
            displayValue = currentExpression;
            updateResultDisplay();
        }

        function safeEvalExpression(expr) {
            if (!/^[0-9+\-*/().\s]+$/.test(expr)) {
                throw new Error("Unsafe expression");
            }
            // eslint-disable-next-line no-new-func
            return Function("return " + expr)();
        }

        function calculate() {
            if (!currentExpression) return;
            try {
                const expr = currentExpression;
                const value = safeEvalExpression(expr);
                if (!isFinite(value)) throw new Error("Invalid");
                const resultStr = value.toString().includes(".")
                    ? parseFloat(value.toFixed(10)).toString()
                    : value.toString();
                showExpression(expr);
                displayValue = resultStr;
                currentExpression = resultStr;
                hasResult = true;
                updateResultDisplay();
            } catch (e) {
                displayValue = "Error";
                updateResultDisplay();
                setTimeout(clearDisplay, 1200);
            }
        }

        // ==== Keyboard: ignore when chat is active or input focused ====
        document.addEventListener("keydown", (event) => {
            const activeTag = document.activeElement?.tagName;
            const isTypingField =
                activeTag === "INPUT" ||
                activeTag === "TEXTAREA" ||
                document.activeElement?.isContentEditable;

            const chatPanelActive =
                document.getElementById("panel-chat")?.classList.contains("active");

            if (isTypingField || chatPanelActive) {
                return; // let chat input handle keys
            }

            const k = event.key;
            if (k >= "0" && k <= "9") {
                appendDigit(k);
                event.preventDefault();
            } else if (k === ".") {
                appendDot();
                event.preventDefault();
            } else if (["+", "-", "*", "/"].includes(k)) {
                appendOp(k);
                event.preventDefault();
            } else if (k === "Enter" || k === "=") {
                calculate();
                event.preventDefault();
            } else if (k === "Backspace") {
                backspace();
                event.preventDefault();
            } else if (k === "Escape") {
                clearDisplay();
                event.preventDefault();
            }
        });

        document.addEventListener("click", () => ensureAudio(), { once: true });

        // ==== Mode switching ====
        const tabStandard = document.getElementById("tab-standard");
        const tabChat = document.getElementById("tab-chat");
        const panelStandard = document.getElementById("panel-standard");
        const panelChat = document.getElementById("panel-chat");
        const modeLabel = document.getElementById("mode-label");

        function setMode(mode) {
            if (mode === "standard") {
                tabStandard.classList.add("active");
                tabChat.classList.remove("active");
                panelStandard.classList.add("active");
                panelChat.classList.remove("active");
                modeLabel.textContent = "Standard";
            } else {
                tabChat.classList.add("active");
                tabStandard.classList.remove("active");
                panelChat.classList.add("active");
                panelStandard.classList.remove("active");
                modeLabel.textContent = "AI Chat";
            }
        }

        tabStandard.addEventListener("click", () => setMode("standard"));
        tabChat.addEventListener("click", () => setMode("chat"));

        // ==== AI Chat math solver ====
        const chatWindow = document.getElementById("chat-window");
        const chatInput = document.getElementById("chat-input");
        const chatSend = document.getElementById("chat-send");

        function addChatBubble(text, isUser) {
            const div = document.createElement("div");
            div.classList.add("chat-msg");
            div.classList.add(isUser ? "user" : "bot");
            div.textContent = text;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function voiceTextToExpression(text) {
            if (!text) return "";

            let t = " " + text.toLowerCase() + " ";

            t = t.replace(/ plus | add /g, " + ");
            t = t.replace(/ minus | subtract /g, " - ");
            t = t.replace(/ into | multiplied by | multiply by | times /g, " * ");
            t = t.replace(/ divided by | divide by | over /g, " / ");
            t = t.replace(/ point /g, ".");

            t = t.replace(/ (please|equals|equal|calculate|answer|and|solve|for|is) /g, " ");

            const map = {
                " zero ": " 0 ", " one ": " 1 ", " two ": " 2 ", " three ": " 3 ", " four ": " 4 ",
                " five ": " 5 ", " six ": " 6 ", " seven ": " 7 ", " eight ": " 8 ", " nine ": " 9 ",
                " ten ": " 10 ", " eleven ": " 11 ", " twelve ": " 12 ", " thirteen ": " 13 ",
                " fourteen ": " 14 ", " fifteen ": " 15 ", " sixteen ": " 16 ", " seventeen ": " 17 ",
                " eighteen ": " 18 ", " nineteen ": " 19 ", " twenty ": " 20 ",
                " thirty ": " 30 ", " forty ": " 40 ", " fifty ": " 50 ",
                " sixty ": " 60 ", " seventy ": " 70 ", " eighty ": " 80 ", " ninety ": " 90 "
            };
            for (const [k, v] of Object.entries(map)) {
                t = t.replace(new RegExp(k, "g"), v);
            }

            t = t.replace(/\s+/g, " ").trim();

            if (!/^[0-9+\-*/().\s]+$/.test(t)) return "";
            return t;
        }

        function answerMathQuestion(raw) {
            const exprFromWords = voiceTextToExpression(raw);
            let candidate = exprFromWords;

            if (!candidate) {
                const match = raw.match(/[0-9+\-*/().\s]+/g);
                if (match) candidate = match.join("").trim();
            }

            if (!candidate) {
                return "I couldn’t find a math expression. Try like “12 + 7” or “30 divided by 6”.";
            }

            try {
                const value = safeEvalExpression(candidate);
                if (!isFinite(value)) throw new Error("Invalid");
                const pretty = candidate.replace(/\*/g, "×").replace(/\//g, "÷");
                const resultStr = value.toString().includes(".")
                    ? parseFloat(value.toFixed(10)).toString()
                    : value.toString();
                return `Expression: ${pretty}\nAnswer: ${resultStr}`;
            } catch (e) {
                return "That expression looks invalid. Check your numbers and operators and try again.";
            }
        }

        function handleChatSend() {
            const text = chatInput.value.trim();
            if (!text) return;
            addChatBubble(text, true);
            chatInput.value = "";

            const reply = answerMathQuestion(text);
            addChatBubble(reply, false);
        }

        chatSend.addEventListener("click", handleChatSend);
        chatInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                handleChatSend();
                e.preventDefault();
            }
        });

        // Initial bot greeting
        addChatBubble(
            "Hi, I’m Jishnu Math AI. Ask me any basic arithmetic question like “5 + 9 × 3” or “twenty five divided by five”.",
            false
        );
    </script>
</body>
</html>
